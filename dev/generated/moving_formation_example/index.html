<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Moving Formation Example · AlgebraicOptimization.jl</title><meta name="title" content="Moving Formation Example · AlgebraicOptimization.jl"/><meta property="og:title" content="Moving Formation Example · AlgebraicOptimization.jl"/><meta property="twitter:title" content="Moving Formation Example · AlgebraicOptimization.jl"/><meta name="description" content="Documentation for AlgebraicOptimization.jl."/><meta property="og:description" content="Documentation for AlgebraicOptimization.jl."/><meta property="twitter:description" content="Documentation for AlgebraicOptimization.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AlgebraicOptimization.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">AlgebraicOptimization.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../flocking_example/">Flocking Example</a></li><li><a class="tocitem" href="../consensus_example/">Consensus Example</a></li><li class="is-active"><a class="tocitem" href>Moving Formation Example</a></li></ul></li><li><span class="tocitem">Cellular Sheaf Macro</span><ul><li><a class="tocitem" href="../sheaf_macro/">-</a></li></ul></li><li><a class="tocitem" href="../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Moving Formation Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Moving Formation Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicOptimization.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicOptimization.jl/blob/main/docs/literate/moving_formation_example.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Moving-Formation-Example"><a class="docs-heading-anchor" href="#Moving-Formation-Example">Moving Formation Example</a><a id="Moving-Formation-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Moving-Formation-Example" title="Permalink"></a></h1><p>This example combines a formation goal in positions with a consensus goal in velocities. As such, the coordination sheaf is the constant sheaf <span>$\underline{\R}^4$</span> on the three vertex path graph. This encodes a leader-follower topology with the middle agent in the path acting as the leader. The leader’s objective is to track a constant rightward velocity vector and minimize its control actuation while the followers’ objectives are to simply minimize control actuation. The edge potential functions are of the form <span>$U_e(y)=(1/2)\|y-b_e\|_2^2$</span> where the velocity coordinates of each be are 0 encoding consensus in velocity while the position coordinates are chosen to achieve a fixed displacement between the leader and its followers. The results of this controller run for 160 iterations are shown below.</p><pre><code class="language-julia hljs">using Test
using AlgebraicOptimization
using LinearAlgebra
using BlockArrays
using Plots
include(&quot;../../../examples/paper-examples/PaperPlotting.jl&quot;)
using .PaperPlotting</code></pre><p>Set up each agent&#39;s dynamics: <span>$x(t+1) = Ax(t) + Bu(t)$</span></p><pre><code class="language-julia hljs">dt = 0.1 # Discretization step size
A = [1 dt 0 0; 0 1 0 0; 0 0 1 dt; 0 0 0 1]
B = [0 0; dt 0; 0 0; 0 dt]
C = [1 0 0 0; 0 0 1 0]
system = DiscreteLinearSystem(A, B, C)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DiscreteLinearSystem([1.0 0.1 0.0 0.0; 0.0 1.0 0.0 0.0; 0.0 0.0 1.0 0.1; 0.0 0.0 0.0 1.0], [0.0 0.0; 0.1 0.0; 0.0 0.0; 0.0 0.1], [1 0 0 0; 0 0 1 0])</code></pre><p>Initialize the weight matrices such that the objective only concerns velocities</p><pre><code class="language-julia hljs">Q_leader = [0 0 0 0; 0 50 0 0; 0 0 0 0; 0 0 0 50]
Q_follower = zeros(4, 4)
R = I(2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×2 LinearAlgebra.Diagonal{Bool, Vector{Bool}}:
 1  ⋅
 ⋅  1</code></pre><p>Define the parameters for the MPC</p><pre><code class="language-julia hljs">N = 10
control_bounds = [-2.0, 2.0]
params1 = MPCParams(Q_leader, R, system, control_bounds, N, [0.0, 3.0, 0.0, 0.0]) # track this velocity
params2 = params3 = MPCParams(Q_follower, R, system, control_bounds, N)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MPCParams([0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0], Bool[1 0; 0 1], DiscreteLinearSystem([1.0 0.1 0.0 0.0; 0.0 1.0 0.0 0.0; 0.0 0.0 1.0 0.1; 0.0 0.0 0.0 1.0], [0.0 0.0; 0.1 0.0; 0.0 0.0; 0.0 0.1], [1 0 0 0; 0 0 1 0]), [-2.0, 2.0], 10, [0.0, 0.0, 0.0, 0.0])</code></pre><p>Define the constant sheaf</p><pre><code class="language-julia hljs">c = CellularSheaf([4, 4, 4], [4, 4])
set_edge_maps!(c, 1, 2, 1, I(4), I(4))
set_edge_maps!(c, 1, 3, 2, I(4), I(4))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4×4 LinearAlgebra.Diagonal{Int64, Vector{Int64}}:
 -1   ⋅   ⋅   ⋅
  ⋅  -1   ⋅   ⋅
  ⋅   ⋅  -1   ⋅
  ⋅   ⋅   ⋅  -1</code></pre><p>Set up solver to perform MPC and solve the optimization problem with ADMM</p><pre><code class="language-julia hljs">x_init = BlockArray(5 * rand(-1.0:0.1:1.0, 12), c.vertex_stalks)
b = [5, 0, 5, 0, -5, 0, 5, 0] # Desired pairwise distance
prob = MultiAgentMPCProblem([params1, params2, params3], c, x_init, b)
alg = ADMM(2.0, 10)
num_iters = 160</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">160</code></pre><p>Run solver on MPC</p><pre><code class="language-julia hljs">trajectory, controls = do_mpc!(prob, alg, num_iters)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Any[[-5.0, -2.0, 3.5, -5.0, 0.0, -1.5, 3.5, 1.0, -4.0, 0.0, -3.0, 2.5], [-5.2, -1.7999999980022774, 3.0, -4.799999998002156, -0.15000000000000002, -1.700000001970668, 3.6, 0.7999999980283218, -4.0, 0.20000000182719724, -2.75, 2.317109762224408], [-5.379999999800228, -1.5999999960046751, 2.520000000199784, -4.599999996004417, -0.32000000019706687, -1.9000000038769, 3.679999999802832, 0.5999999961074363, -3.9799999998172804, 0.40000000357656906, -2.5182890237775593, 2.131011168531731], [-5.539999999400695, -1.399999994007207, 2.0600000005993424, -4.399999994006795, -0.5100000005847569, -2.100000005763574, 3.7399999994135755, 0.3999999941877554, -3.9399999994596233, 0.6000000051187643, -2.3051879069243864, 1.9427148845302997], [-5.679999998801416, -1.1999999920098892, 1.6200000011986628, -4.199999992009303, -0.7200000011611143, -2.3000000076168354, 3.779999998832351, 0.1999999922695213, -3.879999998947747, 0.8000000035595336, -2.1109164184713562, 1.7532793377850266], [-5.799999998002405, -0.9999999900127409, 1.2000000019977324, -3.9999999900119576, -0.9500000019227979, -2.5000000093997383, 3.7999999980593033, -9.646959953091283e-9, -3.7999999985917934, 0.98190410990618, -1.9355884846928535, 1.5636457509258137], [-5.899999997003679, -0.7999999880157856, 0.8000000029965366, -3.799999988014777, -1.2000000028627718, -2.7000000109344224, 3.7999999970946075, -0.2000000115612141, -3.701809587601175, 1.1419757295618382, -1.779223909600272, 1.374690368724492], [-5.979999995805257, -0.5999999860169708, 0.4200000041950589, -3.5999999860158676, -1.470000003956214, -2.8922643076731207, 3.779999995938486, -0.4000000134727408, -3.5876120146449915, 1.281536586183286, -1.6417548727278228, 1.1871908927314365], [-6.039999994406954, -0.3999999840182496, 0.06000000559347213, -3.399999984017036, -1.759226434723526, -3.044295980396078, 3.739999994591212, -0.6000000153807796, -3.459458356026663, 1.401958599897439, -1.5230357834546793, 1.0017793524721732], [-6.079999992808779, -0.19999998202207733, -0.2799999928082315, -3.1999999820205063, -2.063656032763134, -3.1581160592022743, 3.679999993053134, -0.8000000172838464, -3.3192624960369193, 1.505592131961282, -1.4228578482074619, 0.8189896714005463]  …  [33.51645418700623, 3.005966779655643, -3.087222904461406, 0.00948258776686651, 28.890698673581813, 2.853176842480776, -7.7485915040897, 0.010756714818999133, 38.90723473538074, 2.851944355579245, -7.748947347140107, 0.012349190679431882], [33.8170508649718, 3.005574262808912, -3.0862746456847194, 0.009316278381907215, 29.17601635782989, 2.854000288846088, -7.7475158326078, 0.0016770624474393286, 39.19242917093867, 2.8525311677292584, -7.747712428072164, 0.003117325497505617], [34.11760829125269, 3.005191154157824, -3.0853430178465286, 0.009133799404594505, 29.4614163867145, 2.855142283771276, -7.747348126363057, -0.007007301609412379, 39.477682287711595, 2.853462028735025, -7.747400695522414, -0.005712203832154764], [34.41812740666847, 3.004817840616998, -3.0844296379060694, 0.008936303885810497, 29.746930615091628, 2.8565863147573793, -7.748048856523998, -0.015293184893955834, 39.7630284905851, 2.8547190324862517, -7.747971915905629, -0.014136061076000088], [34.71860919073017, 3.0044547314762156, -3.0835360075174885, 0.00872492967955014, 30.032589246567365, 2.8583158815810696, -7.749578175013394, -0.023178472202155215, 40.04850039383373, 2.8562842847340937, -7.749385522013229, -0.022152045133012818], [35.01905466387779, 3.0041022248880846, -3.0826635145495334, 0.008500797395377464, 30.318420834725472, 2.8603145327359925, -7.751896022233609, -0.030662084436453876, 40.334128822307136, 2.858139948059313, -7.75160072652653, -0.029759043443119554], [35.319464886366596, 3.0037606916374333, -3.0818134348099955, 0.008265008482887944, 30.60445228799907, 2.8625659004385677, -7.754962230677254, -0.03774393673887374, 40.61994281711307, 2.860268284418597, -7.754576630870842, -0.036956984923113986], [35.61984095553034, 3.003430467576852, -3.080986933961707, 0.008018643447259022, 30.890708878042926, 2.8650537341968247, -7.758736624351141, -0.04442489603929663, 40.90596964555493, 2.8626516953020182, -7.7582723293631535, -0.04374679256399473], [35.920184002288025, 3.0031118504408845, -3.080185069616981, 0.007762760193461692, 31.17721425146261, 2.8677619327348776, -7.763179113955071, -0.0507067381347753, 41.192234815085136, 2.8652727595119867, -7.762647008619553, -0.050130335823128945], [36.22049518733211, 3.0028050988504753, -3.0794087935976346, 0.007498392498253304, 31.463990444736098, 2.870674574419323, -7.768249787768549, -0.05659210443131732, 41.47876209103634, 2.8681142686592374, -7.767660042201866, -0.0561103829317676]], Any[[2.0000000199772257, 2.0000000199784425, -2.0000000197066794, -2.000000019716782, 2.0000000182719724, -1.8289023777559223], [2.0000000199760217, 2.000000019977388, -2.00000001906232, -2.0000000192088554, 2.000000017493718, -1.8609859369267698], [2.000000019974681, 2.00000001997622, -2.0000000188667406, -2.0000000191968086, 2.0000000154219517, -1.8829628400143101], [2.0000000199731782, 2.0000000199749177, -2.0000000185326146, -2.0000000191823406, 1.9999999844076926, -1.8943554674527296], [2.000000019971483, 2.0000000199734576, -2.0000000178290294, -2.0000000191648124, 1.8190410634664642, -1.8963358685921283], [2.0000000199695522, 2.000000019971809, -2.000000015346843, -2.0000000191425413, 1.6007161965565824, -1.889553822013218], [2.0000000199881485, 2.000000019989093, -1.9226429673869847, -2.0000000191152667, 1.3956085662144768, -1.8749947599305536], [2.000000019987212, 2.0000000199883132, -1.5203167272295752, -2.000000019080388, 1.2042201371415326, -1.8541154025926325], [2.0000000199617225, 2.000000019965297, -1.1382007880619613, -2.0000000190306673, 1.0363353206384294, -1.8278968107162687], [2.0000000199581263, 2.0000000199623797, -0.7769601797961937, -2.000000018905637, 0.8911807323732137, -1.7944409891894306]  …  [-0.004016285288766785, -0.001489737251462565, 0.004884109707108863, -0.09470630683027433, 0.0022489269866062655, -0.09629683689824191], [-0.003925168467310005, -0.001663093849592961, 0.00823446365311978, -0.09079652371559804, 0.00586812150013314, -0.09231865181926265], [-0.003831086510885591, -0.0018247897731270967, 0.01141994925187935, -0.08684364056851707, 0.009308610057664446, -0.08829529329660381], [-0.0037331354082588285, -0.0019749551878400695, 0.014440309861034256, -0.08285883284543455, 0.012570037512265994, -0.08423857243845323], [-0.00363109140782336, -0.002113742062603586, 0.017295668236903646, -0.07885287308199382, 0.01565252247842112, -0.0801598405701273], [-0.003525065881309565, -0.0022413228417267504, 0.019986511549228394, -0.07483612234298662, 0.01855663325219055, -0.07606998310106734], [-0.0034153325065125117, -0.0023578891248952037, 0.02251367702575201, -0.07081852302419864, 0.02128336359284143, -0.07197941479994428], [-0.0033022406058118075, -0.0024636503562892147, 0.02487833758256997, -0.06680959300422888, 0.023834108834209555, -0.06789807640880743], [-0.003186171359677124, -0.002558832537973307, 0.027081985380530284, -0.06281842095478675, 0.026210642099684617, -0.06383543259134211], [-0.0030675159040935195, -0.0026436769520838768, 0.029126416844451764, -0.058853662965420196, 0.028415091472508713, -0.059800471086386565]])</code></pre><p>Plot results with triangles</p><pre><code class="language-julia hljs">PaperPlotting.plot_trajectories(trajectory, C, false, true)</code></pre><img src="8a0601f3.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../consensus_example/">« Consensus Example</a><a class="docs-footer-nextpage" href="../sheaf_macro/">- »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Monday 5 May 2025 16:51">Monday 5 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
